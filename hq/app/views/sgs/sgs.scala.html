@import model.{AwsAccount, SGOpenPortsDetail, SGInUse}

@(flaggedSgsByAccount: List[(model.AwsAccount, Either[utils.attempt.FailedAttempt, List[(model.SGOpenPortsDetail, Set[model.SGInUse])]])])


@main(List("Security Groups")) { @* Header *@
    <div class="container">
        <div class="row">
            <h1 class="header center-on-small-only grey-text text-lighten-5">Security Groups</h1>
            <div class="col s12 m9">
                <h4 class="grey-text text-darken-4 center-on-small-only">For all accounts</h4>
            </div>
        </div>
    </div>

} { @* Main content *@
    <div class="container">
        <div class="row">
            <h2>Open Security Groups</h2>
            <p>The following Security Groups have ports open to the world, i.e. a CIDR set to <code>0.0.0.0/0</code>.</p>
        </div>

        @for((account, flaggedSgsAttempt) <- flaggedSgsByAccount) {
            <div class="row">
                <h3>@account.name</h3>

                @if(flaggedSgsAttempt.isLeft) {
                    <div class="card-panel yellow">
                        <p class="warning">
                            <i class="material-icons right">warning</i>
                            @for(err <- flaggedSgsAttempt.left.get.failures) {
                                @err.friendlyMessage
                            }
                        </p>
                    </div>
                } else {
                    @views.html.fragments.openSecurityGroups(flaggedSgsAttempt.right.get)
                }
            </div>
        }
    </div>
}
